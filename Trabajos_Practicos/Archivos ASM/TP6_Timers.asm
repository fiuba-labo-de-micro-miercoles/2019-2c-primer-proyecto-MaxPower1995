; Timers-tl6.asm
;
; Created: 9/8/2020 10:47:13
; Author : maporta

.INCLUDE "M328PDEF.INC"
.DEF aux = R16


.CSEG							;COMIENZO ESCRITURA EN ROM
.ORG 0X0000						;INICIO DE LA ROM
	JMP MAIN

.ORG OVF1addr					
	JMP INTERRUPCION


.ORG INT_VECTORS_SIZE			;52 WORDS EN ATMEGA328P

MAIN:
	LDI R16,0XFF
	OUT DDRB,R16
	LDI R16,0X00
	OUT DDRD,R16
	SBI PORTB,0			;ARRANCA CON LED OFF

	LDI R16,0X00
	STS TCCR1A,R16				;CONFIGURO EN MODO NORMAL
	STS TCCR1B,R16
	LDI R16,0X01
	STS TIMSK1,R16				;ACTIVO INTERRUPCION X OVERFLOW
	LDI R16,0X00

	SEI							;ACTIVO INTERRUPCIONES

LOOP:
	IN R17,PIND
	CPI R17,0X00
	BREQ CLK_OFF
	CPI R17,0X01
	BREQ CLK_64
	CPI R17,0X02
	BREQ CLK_256
	CPI R17,0X03
	BREQ CLK_1024
	JMP LOOP


CLK_OFF:
	LDI R16,0X00
	STS TCCR1B,R16		;APAGO EL CLOCK
	SBI PORTB,0			;ENCIENDE EL LED
	JMP LOOP

CLK_64:
	LDI R16,0X03
	STS TCCR1B,R20
	JMP LOOP

CLK_256:
	LDI R20,0X04
	STS TCCR1B,R20
	JMP LOOP

CLK_1024:
	LDI R20,0X05
	STS TCCR1B,R20
	JMP LOOP



INTERRUPCION:						
	SBIC PORTB,0					;MIRO EL ESTADO DEL LED
	JMP APAGO
	SBI PORTB,0
	RETI
APAGO:
	CBI PORTB,0
	RETI
	